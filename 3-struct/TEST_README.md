# Тесты для проекта 3-struct

Этот документ описывает тестовое покрытие проекта и инструкции по запуску тестов.

## Структура тестов

### Модуль `bins` (`bins/bins_test.go`)
- **TestNewBin** - тестирует создание нового бина с правильными параметрами
- **TestNewList** - тестирует создание пустого списка бинов
- **TestAddToList** - тестирует добавление бинов в список
- **TestOutputBin** - тестирует вывод информации о бине
- **TestOutputList** - тестирует вывод списка бинов
- **TestEmptyListOutput** - тестирует вывод пустого списка

### Модуль `files` (`files/files_test.go`, `files/files_integration_test.go`)
- **TestNewJsonDb** - тестирует создание JSON базы данных
- **TestReadValidJsonFile** - тестирует чтение валидного JSON файла
- **TestReadNonExistentFile** - тестирует обработку ошибки при чтении несуществующего файла
- **TestReadNonJsonFile** - тестирует валидацию расширения файла
- **TestWriteValidContent** - тестирует запись валидного содержимого
- **TestWriteEmptyContent** - тестирует запись пустого содержимого
- **TestJsonExtensionConstant** - тестирует константу расширения файла
- **TestJsonDbWithRealTestFile** - интеграционный тест с реальным файлом
- **TestJsonDbWriteAndReadCycle** - тестирует цикл записи и чтения
- **TestJsonDbMultipleWrites** - тестирует множественные записи

### Модуль `config` (`config/config_test.go`)
- **TestNewConfigWithValidEnvVar** - тестирует создание конфигурации с валидной переменной окружения
- **TestNewConfigWithEmptyEnvVar** - тестирует панику при отсутствии переменной окружения
- **TestNewConfigWithWhitespaceEnvVar** - тестирует панику при пустой переменной окружения
- **TestConfigStructure** - тестирует структуру конфигурации

### Модуль `storage` (`storage/storage_test.go`)
- **TestNewStorage** - тестирует создание хранилища с данными
- **TestNewStorageWithEmptyFile** - тестирует создание хранилища с пустым файлом
- **TestSetList** - тестирует установку списка бинов
- **TestDeleteFromList** - тестирует удаление элементов из списка
- **TestDeleteFromListNonExistentId** - тестирует удаление несуществующего элемента
- **TestStorageFileNameConstant** - тестирует константу имени файла

### Модуль `api` (`api/api_test.go`)
- **TestNewApi** - тестирует создание API с конфигурацией
- **TestApiUrlConstant** - тестирует константу URL API
- **TestGetHttpClient** - тестирует создание HTTP клиента
- **TestGetHttpClientWithData** - тестирует создание HTTP клиента с данными
- **TestCreateBinResponseStructure** - тестирует структуру ответа
- **TestApiWithNilConfig** - тестирует поведение с nil конфигурацией

### Интеграционные тесты (`main_test.go`)
- **TestMainIntegration** - интеграционный тест основных компонентов
- **TestMainWithValidEnvironment** - тест с валидной средой
- **TestMainWithMissingEnvironment** - тест с отсутствующей переменной окружения
- **TestMainDependencies** - тест доступности зависимостей

## Запуск тестов

### Запуск всех тестов
```bash
go test ./...
```

### Запуск тестов с подробным выводом
```bash
go test -v ./...
```

### Запуск тестов конкретного модуля
```bash
# Тесты для модуля bins
go test ./bins

# Тесты для модуля files
go test ./files

# Тесты для модуля config
go test ./config

# Тесты для модуля storage
go test ./storage

# Тесты для модуля api
go test ./api

# Интеграционные тесты
go test ./main
```

### Запуск тестов с покрытием
```bash
go test -cover ./...
```

### Генерация отчета о покрытии
```bash
go test -coverprofile=coverage.out ./...
go tool cover -html=coverage.out -o coverage.html
```

## Требования для тестов

### Переменные окружения
Тесты автоматически устанавливают переменную окружения `X_MASTER_KEY` для тестирования. В реальной среде эта переменная должна быть установлена вручную.

### Файлы
Тесты создают временные файлы и автоматически их удаляют после завершения. Некоторые тесты используют файл `test_data.json` из корня проекта.

## Особенности тестирования

### HTTP запросы
Тесты для модуля `api` не выполняют реальные HTTP запросы, а тестируют только создание HTTP клиентов и запросов. Для полного тестирования HTTP взаимодействий рекомендуется использовать `httptest.Server`.

### Паника
Некоторые тесты проверяют панику при определенных условиях (например, отсутствие переменной окружения). Это нормальное поведение для текущей реализации.

### Временные файлы
Тесты создают временные файлы в текущей директории и автоматически их удаляют. Убедитесь, что у процесса есть права на создание и удаление файлов.

## Рекомендации по улучшению

1. **Добавить мокирование HTTP клиента** для полного тестирования API модуля
2. **Добавить тесты для обработки ошибок** в основных функциях
3. **Использовать таблично-управляемые тесты** для более компактного кода
4. **Добавить бенчмарки** для критичных по производительности функций
5. **Настроить CI/CD** для автоматического запуска тестов

## Статистика покрытия

После запуска всех тестов вы можете получить статистику покрытия кода:

```bash
go test -coverprofile=coverage.out ./...
go tool cover -func=coverage.out
```

Это покажет процент покрытия для каждого файла и функции.
